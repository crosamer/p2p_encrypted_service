<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P2P Encrypted Chat</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<!-- ============ SIDEBAR ============ -->
<div class="sidebar">
    <h2>ğŸ” P2P Encrypted</h2>
    <input id="peer" placeholder="Peer Name">
    <input id="ip" placeholder="IP Address">
    <input id="port" placeholder="Port">
    <button onclick="connectPeer()">Connect</button>
</div>

<!-- ============ CHAT ============ -->
<div class="chat-container">
    <div class="chat-header">
        <h3>Group Chat</h3>
    </div>

    <div class="chat-messages" id="chat"></div>

    <div class="chat-input">
        <input id="msg" placeholder="Type your message..." 
               onkeydown="if(event.key==='Enter') sendMsg()">
        <button onclick="sendMsg()">Send</button>
    </div>
</div>

<script>
const socket = io();
const chat = document.getElementById("chat");

function addMessage(text, cls) {
    const div = document.createElement("div");
    div.className = "message " + cls;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function connectPeer() {
    socket.emit("connect_peer", {
        peer: document.getElementById("peer").value,
        ip: document.getElementById("ip").value,
        port: document.getElementById("port").value
    });
}

function sendMsg() {
    const msg = document.getElementById("msg");
    if (!msg.value.trim()) return;

    socket.emit("send_message", {
        message: msg.value
    });

    addMessage("You: " + msg.value, "you");
    msg.value = "";
}

socket.on("message", msg => {
    if (msg.startsWith("[You]")) return;
    addMessage(msg, "peer");
});

socket.on("system", msg => {
    addMessage("[SYSTEM] " + msg, "system");
});
</script>

</body>
</html>
